<!DOCTYPE html>
<html lang="en">
	<head>

		<title>matcap materials</title>

		<meta charset="utf-8">
		<meta name="generator" content="Three.js Editor">
		<meta name="viewport" content="width=device-width, user-scalable=no, minimum-scale=1.0, maximum-scale=1.0">

		<link rel="stylesheet" href="/css/joystick.css">
		<link rel="stylesheet" href="/css/bootstrap.min.css">
		<link rel="stylesheet" href="/css/bootbox-dialoges.css">

		<script src="/js/Objectid.js"></script>
		<script src="/js/jquery.min.js"></script> 
		<script src="/js/system.min.js"></script>
		<script src="/js/signals.min.js"></script>
		<script src="/js/inflate.min.js"></script>
		<script src="/js/zangodb.min.js"></script>
		<script src="/js/bootstrap.min.js"></script>

		<style>

			body {
				font-family: sans-serif;
				font-size: 13px;
				background-color: #000;
				margin: 0px;
				overflow: hidden;
			}

			#loading-bar {
				width:100%;
				height:100%;
				top:0; left:0;
				position:fixed;
				display:flex;
				align-items:center;
				justify-content:center;
			}

			.middle > * {
				top:0; 
				left:0;
				right:0;
				bottom:0;
				margin:auto;"
				position:absolute;
			}

		</style>

	</head>

	<body ontouchstart="">

		<script src="js/three.js"></script>
		<script src="js/app.js"></script>
		<script src="js/UVsDebug.js"></script>
		<script src="js/FBXLoader.js"></script>
		<script src="js/EditorControls.js"></script>

		<script src="/js/MW.js"></script>
		<script src="/js/MWtps.js"></script>
		<script src="/js/VirtualInput.js"></script>


		<script>

			var player;
			var fbx, mixer;
			var localPlayer;
			var cameraControls;
			var keyInputControls;
			var hair, body, panties,
				bra, torso, skirt, shoes;

			var debugMode = true;

			var loader = new THREE.FileLoader();
			loader.load( "app.json", function ( text ) {

				player = new APP.Player();
				player.load( JSON.parse( text ) );
				player.setSize( window.innerWidth, window.innerHeight );
				player.play();

				document.body.appendChild( player.dom );

				window.addEventListener( "resize", function () {
					player.setSize( window.innerWidth, window.innerHeight );
				});

			//

				(function(){

					var container = document.createElement("div");
					container.id = "loading-bar";
					container.classList.add("middle");

					var progress = document.createElement("div");
					progress.style.width = "250px";
					progress.style.height = "fit-content";
					progress.classList.add("progress");
					container.appendChild( progress );

					var bar = document.createElement("div");
					bar.style.width = "100%";
					bar.textContent = "Loading...";
					bar.setAttribute("role", "progressbar");
					bar.setAttribute("aria-valuemin", "0");
					bar.setAttribute("aria-valuemax", "100");
					bar.classList.add("progress-bar", "progress-bar-striped", "active");
					progress.appendChild( bar );

					document.body.appendChild( container );

				})();

			//

				var loader = new THREE.FBXLoader();
				var url = "/app/alpha/004/model/Carol.fbx";
				loader.load( url, function( object ){

					document.getElementById("loading-bar").remove();

					object.name = "Carol";
					console.log( object ); // object is THREE.Group.

					mixer = new THREE.AnimationMixer( object );

					( new Function( "object", object.animations.map( function(animation, i){
							var name = animation.name.replace("Carol|", "").replace(/\s/g, ""); 
							debugMode && console.log( "\t"+name );
							return "\t"+name+" = mixer.clipAction( object.animations["+i+"], object );";
						}).join("\n")
					) )( object );

				//	skinned meshes.

					( new Function( "object", object.children.filter( function( child ){
							return child.type == "SkinnedMesh";
						}).map( function( skinned ){
							var name = skinned.name;
							debugMode && console.log( "\t"+name.toLowerCase() );
							return "\t"+name.toLowerCase()+" = object.getObjectByName(\""+name+"\");"
						}).join("\n")
					) )( object );

				});


				/*
					bra = object.getObjectByName( "Bra" );
					hair = object.getObjectByName( "Hair" );
					body = object.getObjectByName( "Body" );
					torso = object.getObjectByName( "Torso" );
					skirt = object.getObjectByName( "Skirt" );
					shoes = object.getObjectByName( "Shoes" );
					panties = object.getObjectByName( "Panties" );
				*/

			});



		</script>

	</body>
</html>
